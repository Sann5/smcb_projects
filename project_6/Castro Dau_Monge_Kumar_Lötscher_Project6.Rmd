---
title: "Project 6"
author: "Santiago Castro Dau, June Monge, Rachita Kumar, Sarah LÃ¶tscher"
date: '2022-04-11'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Problem 15: Monte Carlo estimation of an expected value
### 1. Show that: $...$



## Problem 16: Sampling in the Rain Network
### a) Derive the expressions for P (C = T | R = T, S = T, W = T), P (C = T | R = F, S =T, W = T), P (R = T | C = T, S = T, W = T) and P (R = T | C = F, S = T, W = T) and compute their values.

\begin{equation*}
\begin{split}
  P(C=T|R=T,S=T,W=T)&=P(C=T|R=T,S=T)&=\frac{P(C=T)P(S=T,R=T|C=T)}{P(S=T,R=T)}\\     &=\frac{P(C=T)P(S=T|C=T)P(R=T|C=T)}{P(C=T)P(S=T|C=T)P(R=T|C=T)+P(C=F)P(S=T|C=F)P(R=T|C=F)}\\
&=\frac{0.5*0.1*0.8}{0.53*0.1*0.8+0.5*0.5*0.2}&=0.4444

P(C=T|R=F,S=T,W=T)&=\frac{P(C=T)P(S=T|C=T)P(R=F|C=T)}{P(C=T)P(S=T|C=T)P(R=F|C=T)+P(C=F)P(S=T|C=F)P(R=F|C=F)}\\
&=\frac{0.5*0.1*0.2}{0.5*0.1*0.2+0.5*0.5*0.8}&=0.04761905



P(R=T|C=T,S=T,W=T)&=\frac{P(R=T|C=T,S=T)P(W=T|R=T,C=T,S=T)}{P(W=T|C=T,S=T)}&=\frac{P(R=T|C=T)P(W=T|R=T,S=T)}{P(W=T|C=T,S=T)}\\  &=\frac{P(R=T|C=T)P(W=T|R=T,S=T)}{P(R=T|C=T)P(W=T|R=T,S=T)+P(R=F|C=T)P(W=T|R=F,S=T)}\\
&=\frac{0.8*0.99}{0.8*0.99+0.2*0.9}&=0.8148

P(R=T|C=F,S=T,W=T)&=\frac{P(R=T|C=F)P(W=T|R=T,S=T)}{P(R=T|C=F)P(W=T|R=T,S=T)+P(R=F|C=F)P(W=T|R=F,S=T)}\\
&=\frac{0.2*0.99}{0.2*0.99+0.8*0.9}&=0.2156863


\end{split}
\end{equation*}


### b) Implement the Gibbs sampler for the Bayesian network 


```{r, echo = FALSE}
library("coda")

```


```{r}

#returns 1 with probability p, and 0 with probability 1-p
rbernoulli=function(p){return(1*runif(1)<p)}



# sample from distribution X given Y above
sample_CgivenR = function(R){
 if(R==0){
   C = rbernoulli(0.0476) # returns 1 with probability 0.2; otherwise 0
 } else {
   C = rbernoulli(0.4444)
 } 
  return(C)
}
#' sample from distribution Y given X above
sample_RgivenC = function(C){
  if(C==0){
    R = rbernoulli(0.2157)
  } else {
    R = rbernoulli(0.8148)
  }
  return(R)
}
set.seed(100)
niter = 100
C = rep(0,niter)
R = rep(0,niter)
C[1]=1
R[1]=1 # start from (1,1)
for(i in 2:niter){
  C[i] = sample_CgivenR(R[i-1])
  R[i] = sample_RgivenC(C[i])
}
res = data.frame(C=C,R=R)
res


```



```{r}
#Display a 2-by-2 table for the sampled R and C.
#1=True, 0=False
#Row is Cloudy, Column is Rain

table(data.frame(C=C,R=R))/niter

```


### c) Estimate the marginal probability of rain, given that the sprinkler is on and the grass is wet

```{r}

```


### d) Draw 50,000 samples instead of 100 using the Gibbs sampler

```{r}

```

### e) Plot the relative frequencies of R = T and C = T up to each iteration t against t, for two independent runs of the sampler. Suggest a burn-in time based on this plot.

```{r}

```

### f) Apply the Gelman and Rubin test 

```{r}

```

### g) Provide plots for both variables Rain and Cloudy and suggest an interval for drawing approximately independent samples. 

```{r}

```

### h)Re-estimate P (R = T | S = T, W = T) based on samples obtained after the suggested burn-in time and thinning.

```{r}

```

### i)Compute the probability P (R = T | S = T, W = T) analytically. Compare with (c) and (h)
and comment on your results.

```{r}

```


